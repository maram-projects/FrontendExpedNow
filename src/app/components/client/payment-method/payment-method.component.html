<div class="payment-container">
  <div class="payment-card">
    <!-- Header -->
    <div class="payment-header">
      <h2 class="payment-title">Choose Payment Method</h2>
      <div class="total-amount">
        <span class="amount-label">Total:</span>
        <span class="amount-value">{{ totalAmount | currency:currency:'symbol':'1.2-2' }}</span>
      </div>
    </div>

    <!-- Payment Methods -->
    <div class="payment-methods">
      <h3 class="section-title">Payment Options</h3>
      <div class="methods-grid">
        <div 
          *ngFor="let method of paymentMethods" 
          class="method-card"
          [class.selected]="selectedMethod === method.id"
          [class.disabled]="isLoading || paymentProcessing"
          (click)="selectMethod(method.id)"
        >
          <div class="method-icon">
            <i [class]="method.icon"></i>
          </div>
          <div class="method-info">
            <h4 class="method-name">{{ method.name }}</h4>
            <p class="method-description">{{ method.description }}</p>
          </div>
          <div class="selection-indicator">
            <div class="radio-button"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Card Form (for Credit Card) -->
    <div class="card-form-section" *ngIf="showCardForm" [@slideIn]>
      <h3 class="section-title">Card Information</h3>
      
      <!-- Loading state for card element -->
      <div *ngIf="!cardElementMounted" class="card-loading">
        <mat-spinner diameter="30"></mat-spinner>
        <span>Loading payment form...</span>
      </div>
      
      <div class="form-grid" [class.hidden]="!cardElementMounted">
        <div class="form-group">
          <label for="cardholderName">Cardholder Name *</label>
          <input 
            id="cardholderName"
            type="text" 
            [(ngModel)]="billingDetails.name"
            placeholder="John Doe"
            class="form-input"
            [disabled]="paymentProcessing"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Email Address *</label>
          <input 
            id="email"
            type="email" 
            [(ngModel)]="billingDetails.email"
            placeholder="john@example.com"
            class="form-input"
            [disabled]="paymentProcessing"
            required
          />
        </div>

      <!-- payment-method.component.html -->
<div class="form-group full-width">
  <label for="card-element">Card Details *</label>
  <div id="card-element" class="stripe-element"></div>
  <div *ngIf="cardErrors" class="stripe-error">
    <i class="error-icon">‚ö†Ô∏è</i> {{ cardErrors }}
  </div>
  <div *ngIf="showCardForm && !cardElementMounted" class="card-loading">
    <mat-spinner diameter="20"></mat-spinner>
    <span>Loading payment form...</span>
  </div>
</div>

        <div class="form-group">
          <label for="address">Address Line 1</label>
          <input 
            id="address"
            type="text" 
            [(ngModel)]="billingDetails.address.line1"
            placeholder="123 Main Street"
            class="form-input"
            [disabled]="paymentProcessing"
          />
        </div>

        <div class="form-group">
          <label for="city">City</label>
          <input 
            id="city"
            type="text" 
            [(ngModel)]="billingDetails.address.city"
            placeholder="Tunis"
            class="form-input"
            [disabled]="paymentProcessing"
          />
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="paymentError" [@fadeIn]>
      <i class="error-icon">‚ö†Ô∏è</i>
      <span>{{ paymentError }}</span>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button 
        type="button"
        class="btn btn-secondary"
        (click)="navigateToCart()"
        [disabled]="paymentProcessing"
      >
        <i class="btn-icon">‚Üê</i>
        Back to Cart
      </button>

      <button 
        type="button"
        class="btn btn-primary"
        [disabled]="!selectedMethod || paymentProcessing || isLoading || (showCardForm && (!cardElementMounted || !billingDetails.name || !billingDetails.email))"
        (click)="processPayment()"
      >
        <span *ngIf="!paymentProcessing && !isLoading">
          <i class="btn-icon">üí≥</i>
          Pay {{ totalAmount | currency:currency:'symbol':'1.2-2' }}
        </span>
        <span *ngIf="paymentProcessing || isLoading" class="loading-content">
          <mat-spinner diameter="20"></mat-spinner>
          Processing...
        </span>
      </button>
    </div>

    <!-- Security Info -->
    <div class="security-info">
      <div class="security-badge">
        <i class="security-icon">üîí</i>
        <span>Secure Payment</span>
      </div>
      <p class="security-text">Your payment information is encrypted and secure</p>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading" [@fadeIn]>
    <div class="loading-content">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Initializing payment...</p>
    </div>
  </div>
</div>
<div class="dashboard-container">
  <!-- Status Cards -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card status-card pending">
        <div class="card-body">
          <h5 class="card-title">Pending Deliveries</h5>
          <div class="card-content">
            <span class="count">{{ stats.pendingOrders }}</span>
            <i class="fas fa-clock"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card status-card completed">
        <div class="card-body">
          <h5 class="card-title">Completed Deliveries</h5>
          <div class="card-content">
            <span class="count">{{ stats.completedOrders }}</span>
            <i class="fas fa-check-circle"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card status-card total">
        <div class="card-body">
          <h5 class="card-title">Total Deliveries</h5>
          <div class="card-content">
            <span class="count">{{ stats.totalOrders }}</span>
            <i class="fas fa-truck"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications Section -->
  <div class="notifications-section mb-4" *ngIf="notifications.length > 0">
    <h4>
      <i class="fas fa-bell me-2"></i>
      Notifications
      <span class="badge bg-danger" *ngIf="hasUnreadNotifications">New</span>
    </h4>
    <div class="list-group notification-list">
      <div *ngFor="let notification of notifications" 
           class="list-group-item notification-item"
           [class.unread]="!notification.read"
           (click)="markNotificationAsRead(notification)">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{ notification.title }}</h5>
          <small>{{ notification.createdAt | date:'short' }}</small>
        </div>
        <p class="mb-1">{{ notification.message }}</p>
        <small *ngIf="!notification.read" class="text-primary">Click to mark as read</small>
      </div>
    </div>
  </div>

  <!-- Delivery List -->
  <div class="delivery-list">
    <h4>Assigned Deliveries</h4>
    <div *ngIf="deliveries.length === 0" class="no-deliveries">
      <i class="fas fa-box-open"></i>
      <p>No assigned deliveries found</p>
    </div>

    <div class="list-group">
      <div *ngFor="let delivery of deliveries" class="list-group-item delivery-item">
        <div class="delivery-header">
          <span class="badge status-badge {{delivery.status?.toLowerCase()}}">
            {{ delivery.status }}
          </span>
          <small class="text-muted">#{{ delivery.id }}</small>
        </div>
        
        <div class="delivery-body">
          <div class="route-info">
            <div class="route-step">
              <i class="fas fa-map-marker-alt start"></i>
              <span>{{ delivery.pickupAddress }}</span>
            </div>
            <div class="route-step">
              <i class="fas fa-flag-checkered end"></i>
              <span>{{ delivery.deliveryAddress }}</span>
            </div>
          </div>

          <div class="delivery-meta">
            <div>
              <i class="fas fa-box"></i>
              {{ delivery.packageDescription }} ({{ delivery.packageWeight }}kg)
            </div>
            <div>
              <i class="fas fa-calendar-alt"></i>
              {{ delivery.scheduledDate | date:'medium' }}
            </div>
          </div>
        </div>

        <div class="delivery-actions">
          <select #statusSelect (change)="delivery.id && updateStatus(delivery.id, statusSelect.value)"
                  class="form-select status-select" [disabled]="delivery.status === 'DELIVERED'">
            <option value="APPROVED" [selected]="delivery.status === 'APPROVED'">Approved</option>
            <option value="IN_TRANSIT" [selected]="delivery.status === 'IN_TRANSIT'">In Transit</option>
            <option value="DELIVERED" [selected]="delivery.status === 'DELIVERED'">Delivered</option>
          </select>

          <button class="btn btn-map" (click)="openMap(delivery)">
            <i class="fas fa-map-marked-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Availability Toggle -->
  <div class="availability-toggle mt-4">
    <label>Available for deliveries:</label>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" 
             [(ngModel)]="availability" (change)="updateAvailability()">
    </div>
  </div>

  <!-- Current Location Info (hidden but useful for debugging) -->
  <div class="location-info small text-muted mt-3" *ngIf="availability">
    <p>Current location: {{ latitude | number:'1.6-6' }}, {{ longitude | number:'1.6-6' }}</p>
    <small>Location is automatically updated every 2 minutes while available</small>
  </div>
</div>
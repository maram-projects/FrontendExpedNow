<div class="vehicle-management-container">
  <div class="header-section">
    <h2 class="title">ðŸš— Vehicle Fleet Management</h2>
    <div class="controls">
      <button class="view-toggle" (click)="toggleView()">
        <i class="fas" [ngClass]="showAvailable ? 'fa-list-alt' : 'fa-check-circle'"></i>
        {{ showAvailable ? 'Show All Vehicles' : 'Show Available Only' }}
      </button>
      <a *ngIf="isAdmin" routerLink="/admin/vehicles/new" class="add-button">
        <i class="fas fa-rocket"></i> Add New Ride
      </a>
    </div>
  </div>

  <!-- Dashboard Statistics -->
  <div class="dashboard-stats">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-truck-loading"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ vehicles.length }}</div>
        <div class="stat-label">Total Vehicles</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ availableVehicles.length }}</div>
        <div class="stat-label">Available Now</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-route"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ vehicles.length - availableVehicles.length }}</div>
        <div class="stat-label">On Delivery</div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading) {
  <div class="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">Revving up the engines...</div>
  </div>
  }

  <!-- Empty State -->
  @if (!loading && vehicles.length === 0) {
  <div class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-car-crash fa-bounce"></i>
    </div>
    <h3>Zero Vehicles in the Garage!</h3>
    <p>Time to add your first set of wheels</p>
    <a routerLink="/admin/vehicles/new" class="add-button">
      <i class="fas fa-plus"></i> Add Vehicle
    </a>
  </div>
  }

  <!-- Vehicle Grid -->
  @if (!loading && vehicles.length > 0) {
  <div class="vehicle-grid">
    @for (vehicle of (showAvailable ? availableVehicles : vehicles); track vehicle.id) {
    <div class="vehicle-card" [@cardAnimation]>
      <!-- Vehicle Image -->
      <div class="vehicle-image">
        @if (vehicle.photoPath) {
        <img [src]="'http://localhost:8080/uploads/vehicle-photos/' + vehicle.photoPath" 
             alt="{{ vehicle.make }} {{ vehicle.model }}"
             (error)="vehicle.photoPath = null">
        }
        @else {
        <div class="vehicle-icon" [ngClass]="vehicle.vehicleType.toLowerCase()">
          <i [class]="getVehicleIcon(vehicle.vehicleType)"></i>
        </div>
        }
        <!-- Availability Tag -->
        <div class="availability-tag" [class.available]="vehicle.available" [class.unavailable]="!vehicle.available">
          {{ vehicle.available ? 'Ready to roll!' : 'In service' }}
        </div>
      </div>

      <!-- Vehicle Info -->
      <div class="vehicle-info">
        <h3 class="vehicle-title">{{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}</h3>
        <div class="vehicle-details">
          <div class="detail-item">
            <i class="fas fa-id-card"></i>
            <span class="license-plate">{{ vehicle.licensePlate }}</span>
          </div>
          <div class="detail-item">
            <i [class]="getVehicleIcon(vehicle.vehicleType)"></i>
            <span>{{ vehicle.vehicleType | titlecase }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-weight-hanging"></i>
            <span>Max Load: {{ vehicle.maxLoad }} kg</span>
          </div>
        </div>

        <!-- Vehicle Stats Button -->
        <div class="stats-toggle" (click)="toggleVehicleStats(vehicle.id!)">
          <i class="fas" [ngClass]="expandedVehicleId === vehicle.id ? 'fa-chevron-up' : 'fa-chart-bar'"></i>
          {{ expandedVehicleId === vehicle.id ? 'Hide Stats' : 'Show Stats' }}
        </div>

        <!-- Vehicle Statistics (Expandable) -->
        <div class="vehicle-statistics" [@statAnimation]="getStatAnimationState(vehicle.id!)" 
             [class.expanded]="expandedVehicleId === vehicle.id">
          @if (vehicle.id) {
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-route"></i></div>
              <div class="stat-data">
                <div class="stat-value">{{ getVehicleStats(vehicle.id).totalTrips }}</div>
                <div class="stat-label">Total Trips</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-road"></i></div>
              <div class="stat-data">
                <div class="stat-value">{{ getVehicleStats(vehicle.id).totalDistance }} km</div>
                <div class="stat-label">Distance</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
              <div class="stat-data">
                <div class="stat-value">{{ formatLastUsed(getVehicleStats(vehicle.id).lastUsed) }}</div>
                <div class="stat-label">Last Used</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-tachometer-alt"></i></div>
              <div class="stat-data">
                <div class="stat-value">
                  <div class="progress">
                    <div class="progress-bar" role="progressbar" 
                         [style.width.%]="getVehicleStats(vehicle.id).utilizationRate"
                         [ngClass]="{
                           'bg-success': getVehicleStats(vehicle.id).utilizationRate < 50,
                           'bg-warning': getVehicleStats(vehicle.id).utilizationRate >= 50 && getVehicleStats(vehicle.id).utilizationRate < 80,
                           'bg-danger': getVehicleStats(vehicle.id).utilizationRate >= 80
                         }">
                      {{ getVehicleStats(vehicle.id).utilizationRate }}%
                    </div>
                  </div>
                </div>
                <div class="stat-label">Utilization</div>
              </div>
            </div>
          </div>
          }
        </div>
      </div>

      <!-- Vehicle Actions -->
      <div class="vehicle-actions">
        <button *ngIf="vehicle.available" 
                (click)="selectForDelivery(vehicle)" 
                class="btn-action delivery-btn">
          <i class="fas fa-truck-loading"></i> Use for Delivery
        </button>
        <button *ngIf="!vehicle.available" 
                disabled
                class="btn-action delivery-btn disabled">
          <i class="fas fa-clock"></i> In Service
        </button>

        <a *ngIf="isAdmin" [routerLink]="['/admin/vehicles', vehicle.id, 'edit']" 
           class="btn-action edit-btn">
          <i class="fas fa-wrench"></i> Tune Up
        </a>
        <button *ngIf="isAdmin" (click)="deleteVehicle(vehicle.id!)" 
                class="btn-action delete-btn">
          <i class="fas fa-trash"></i> Scrap It
        </button>
      </div>
    </div>
    }
  </div>
  }
</div>
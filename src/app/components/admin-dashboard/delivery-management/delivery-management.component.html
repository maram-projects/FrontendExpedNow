<!-- delivery-management.component.html -->
<div class="delivery-management-container">
  <div class="header">
    <h2><i class="fas fa-truck"></i> Delivery Management</h2>
    <p>Manage all deliveries and missions in the system</p>
  </div>

  <!-- Statistics -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon total">
        <i class="fas fa-box"></i>
      </div>
      <div class="stat-info">
        <h3>{{deliveryStats.total || 0}}</h3>
        <p>Total Deliveries</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon pending">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-info">
        <h3>{{deliveryStats.pending || 0}}</h3>
        <p>Pending</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon assigned">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="stat-info">
        <h3>{{deliveryStats.assigned || 0}}</h3>
        <p>Assigned</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon in-transit">
        <i class="fas fa-shipping-fast"></i>
      </div>
      <div class="stat-info">
        <h3>{{deliveryStats.inTransit || 0}}</h3>
        <p>In Transit</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon delivered">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-info">
        <h3>{{deliveryStats.delivered || 0}}</h3>
        <p>Delivered</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon cancelled">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-info">
        <h3>{{deliveryStats.cancelled || 0}}</h3>
        <p>Cancelled</p>
      </div>
    </div>
  </div>

  <!-- Filters and Actions -->
  <div class="controls-row">
    <div class="filters">
      <div class="filter-group">
        <label for="statusFilter">Status:</label>
        <select id="statusFilter" [(ngModel)]="statusFilter" (change)="applyFilters()">
          <option value="all">All statuses</option>
          <option value="PENDING">Pending</option>
          <option value="ASSIGNED">Assigned</option>
          <option value="APPROVED">Approved</option>
          <option value="IN_TRANSIT">In transit</option>
          <option value="DELIVERED">Delivered</option>
          <option value="CANCELLED">Cancelled</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="searchTerm">Search:</label>
        <input 
          id="searchTerm" 
          type="text" 
          placeholder="Address, package, client..." 
          [(ngModel)]="searchTerm"
          (input)="applyFilters()">
      </div>
      
      <div class="filter-group">
        <label for="dateFilter">Date:</label>
        <input 
          id="dateFilter" 
          type="date" 
          [(ngModel)]="dateFilter"
          (change)="applyFilters()">
      </div>
    </div>
    
    <div class="actions">
      <button class="btn btn-primary" (click)="loadDeliveries()">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
      <button class="btn btn-warning" (click)="expireOldDeliveries()">
        <i class="fas fa-clock"></i> Expire old ones
      </button>
    </div>
  </div>

  <!-- Error message -->
  <div class="error-message" *ngIf="errorMessage">
    <div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i> {{errorMessage}}
      <button class="close-btn" (click)="errorMessage = ''">&times;</button>
    </div>
  </div>

  <!-- Deliveries table -->
  <div class="deliveries-table-container">
    <div class="table-responsive">
      <table class="deliveries-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Pickup Address</th>
            <th>Delivery Address</th>
            <th>Description</th>
            <th>Status</th>
            <th>Creation Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="isLoading">
            <td colspan="7" class="loading-row">
              <div class="spinner"></div>
              <span>Loading deliveries...</span>
            </td>
          </tr>
          
          <tr *ngIf="!isLoading && filteredDeliveries.length === 0">
            <td colspan="7" class="no-data">
              <i class="fas fa-inbox"></i>
              <p>No deliveries found</p>
            </td>
          </tr>
          
          <tr *ngFor="let delivery of paginatedDeliveries" 
              [class.selected]="selectedDelivery?.id === delivery.id"
              (click)="selectDelivery(delivery)">
            <td class="delivery-id">{{delivery.id.substring(0, 8)}}...</td>
            <td class="pickup-address">{{delivery.pickupAddress}}</td>
            <td class="delivery-address">{{delivery.deliveryAddress}}</td>
            <td class="package-description">{{delivery.packageDescription}}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(delivery.status)">
                {{delivery.status}}
              </span>
            </td>
            <td class="created-at">{{delivery.createdAt | date:'short'}}</td>
            <td class="actions-cell">
              <button class="btn btn-sm btn-info" (click)="selectDelivery(delivery); $event.stopPropagation()">
                <i class="fas fa-eye"></i>
              </button>
              <button *ngIf="delivery.status === 'PENDING'" 
                      class="btn btn-sm btn-primary" 
                      (click)="assignDelivery(delivery.id); $event.stopPropagation()">
                <i class="fas fa-user-check"></i>
              </button>
              <button *ngIf="delivery.status !== 'CANCELLED' && delivery.status !== 'DELIVERED'" 
                      class="btn btn-sm btn-danger" 
                      (click)="cancelDelivery(delivery.id); $event.stopPropagation()">
                <i class="fas fa-times"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="pagination" *ngIf="filteredDeliveries.length > 0">
      <button (click)="previousPage()" [disabled]="currentPage === 1">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <span class="page-info">
        Page {{currentPage}} of {{totalPages}}
      </span>
      
      <button (click)="nextPage()" [disabled]="currentPage === totalPages">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Selected delivery details -->
  <div class="delivery-details" *ngIf="selectedDelivery">
    <div class="details-header">
      <h3>Delivery Details #{{selectedDelivery.id.substring(0, 8)}}...</h3>
      <button class="close-btn" (click)="clearSelection()">&times;</button>
    </div>
    
   <!-- Overlay and modal for delivery details -->
<div class="modal-overlay" *ngIf="selectedDelivery" (click)="clearSelection()">
  <div class="delivery-details" (click)="$event.stopPropagation()">
    <div class="details-header">
      <h3><i class="fas fa-box-open"></i> Delivery Details #{{selectedDelivery.id.substring(0, 8)}}...</h3>
      <button class="close-btn" (click)="clearSelection()">&times;</button>
    </div>
    
    <div class="details-content">
      <div class="detail-section">
        <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Status:</label>
            <span class="status-badge" [ngClass]="getStatusClass(selectedDelivery.status)">
              {{selectedDelivery.status}}
            </span>
          </div>
          <div class="detail-item">
            <label>Creation date:</label>
            <span>{{selectedDelivery.createdAt | date:'medium'}}</span>
          </div>
          <div class="detail-item">
            <label>Client ID:</label>
            <span>{{selectedDelivery.clientId}}</span>
          </div>
          <div class="detail-item">
            <label>Package:</label>
            <span>{{selectedDelivery.packageDescription}} ({{selectedDelivery.packageWeight}} kg)</span>
          </div>
        </div>
      </div>
      
      <div class="detail-section">
        <h4><i class="fas fa-map-marker-alt"></i> Addresses</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Pickup:</label>
            <span>{{selectedDelivery.pickupAddress}}</span>
          </div>
          <div class="detail-item">
            <label>Delivery:</label>
            <span>{{selectedDelivery.deliveryAddress}}</span>
          </div>
        </div>
      </div>
      
      <div class="detail-section">
        <h4><i class="fas fa-clipboard-list"></i> Additional instructions</h4>
        <p>{{selectedDelivery.additionalInstructions || 'No additional instructions'}}</p>
      </div>
      
      <div class="detail-section">
        <h4><i class="fas fa-sync-alt"></i> Change status</h4>
        <div class="status-actions">
          <select #statusSelect>
            <option value="PENDING" [selected]="selectedDelivery.status === 'PENDING'">Pending</option>
            <option value="ASSIGNED" [selected]="selectedDelivery.status === 'ASSIGNED'">Assigned</option>
            <option value="APPROVED" [selected]="selectedDelivery.status === 'APPROVED'">Approved</option>
            <option value="IN_TRANSIT" [selected]="selectedDelivery.status === 'IN_TRANSIT'">In transit</option>
            <option value="DELIVERED" [selected]="selectedDelivery.status === 'DELIVERED'">Delivered</option>
            <option value="CANCELLED" [selected]="selectedDelivery.status === 'CANCELLED'">Cancelled</option>
          </select>
          <button class="btn btn-primary" (click)="changeDeliveryStatus(selectedDelivery.id, statusSelect.value)">
            Apply
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
</div>